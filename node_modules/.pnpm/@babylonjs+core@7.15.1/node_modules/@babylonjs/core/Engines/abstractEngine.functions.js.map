{"version":3,"file":"abstractEngine.functions.js","sourceRoot":"","sources":["../../../../dev/core/src/Engines/abstractEngine.functions.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,4BAA2B;AACjD,OAAO,EAAE,mBAAmB,EAAE,iCAAgC;AAQ9D,MAAM,CAAC,MAAM,qBAAqB,GAoB9B,EAAE,CAAC;AAEP;;GAEG;AACH,MAAM,UAAU,kBAAkB,CAAC,MAAc,EAAE,OAAyB,EAAE,gBAAwB,EAAE;IACpG,OAAO,aAAa,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC;AACpE,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,SAAS,CACrB,GAAW,EACX,SAAqE,EACrE,UAAgC,EAChC,eAAkC,EAClC,cAAwB,EACxB,OAA0D,EAC1D,gBAOiB;IAEjB,MAAM,QAAQ,GAAG,gBAAgB,IAAI,qBAAqB,CAAC,QAAQ,CAAC;IACpE,IAAI,QAAQ,EAAE;QACV,MAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,EAAE,SAAS,EAAE,UAAU,EAAE,eAAe,EAAE,cAAc,EAAE,OAAO,CAAC,CAAC;QAC/F,OAAO,OAAO,CAAC;KAClB;IACD,MAAM,WAAW,CAAC,WAAW,CAAC,CAAC;AACnC,CAAC;AAED;;;;GAIG;AACH,MAAM,UAAU,eAAe,CAAC,kBAA+C,IAAI;IAC/E,IAAI,eAAe,IAAI,eAAe,CAAC,aAAa,EAAE;QAClD,OAAO,eAAe,CAAC,aAAa,CAAC;KACxC;IAED,OAAO,mBAAmB,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC;AACnD,CAAC;AAED,gBAAgB;AAChB,MAAM,UAAU,iBAAiB,CAC7B,OAAmC,EACnC,eAAyB,EACzB,qBAA+B,EAC/B,uBAAiC;IAEjC,IAAI,OAAO,EAAE;QACT,IAAI,eAAe,EAAE;YACjB,OAAO,CAAC,oBAAoB,CAAC,GAAG,EAAE,CAAC;SACtC;aAAM;YACH,OAAO,OAAO,CAAC,oBAAoB,CAAC,CAAC;SACxC;QACD,IAAI,qBAAqB,EAAE;YACvB,OAAO,CAAC,yBAAyB,CAAC,GAAG,EAAE,CAAC;SAC3C;aAAM;YACH,OAAO,OAAO,CAAC,yBAAyB,CAAC,CAAC;SAC7C;QACD,IAAI,uBAAuB,EAAE;YACzB,OAAO,CAAC,4BAA4B,CAAC,GAAG,EAAE,CAAC;SAC9C;aAAM;YACH,OAAO,OAAO,CAAC,4BAA4B,CAAC,CAAC;SAChD;QACD,OAAO;KACV;SAAM;QACH,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,IAAI,eAAe,EAAE;YACjB,CAAC,IAAI,4BAA4B,CAAC;SACrC;QACD,IAAI,qBAAqB,EAAE;YACvB,IAAI,CAAC,EAAE;gBACH,CAAC,IAAI,IAAI,CAAC;aACb;YACD,CAAC,IAAI,iCAAiC,CAAC;SAC1C;QACD,IAAI,uBAAuB,EAAE;YACzB,IAAI,CAAC,EAAE;gBACH,CAAC,IAAI,IAAI,CAAC;aACb;YACD,CAAC,IAAI,oCAAoC,CAAC;SAC7C;QACD,OAAO,CAAC,CAAC;KACZ;AACL,CAAC","sourcesContent":["import { _WarnImport } from \"core/Misc/devTools\";\r\nimport { IsDocumentAvailable } from \"core/Misc/domManagement\";\r\nimport type { IFileRequest } from \"core/Misc/fileRequest\";\r\nimport type { LoadFileError } from \"core/Misc/fileTools\";\r\nimport type { IWebRequest } from \"core/Misc/interfaces/iWebRequest\";\r\nimport type { WebRequest } from \"core/Misc/webRequest\";\r\nimport type { IOfflineProvider } from \"core/Offline/IOfflineProvider\";\r\nimport type { Nullable } from \"core/types\";\r\n\r\nexport const EngineFunctionContext: {\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     * @internal\r\n     */\r\n    loadFile?: (\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (ev: ProgressEvent) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: LoadFileError) => void\r\n    ) => IFileRequest;\r\n} = {};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function _ConcatenateShader(source: string, defines: Nullable<string>, shaderVersion: string = \"\"): string {\r\n    return shaderVersion + (defines ? defines + \"\\n\" : \"\") + source;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function _loadFile(\r\n    url: string,\r\n    onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n    onProgress?: (data: any) => void,\r\n    offlineProvider?: IOfflineProvider,\r\n    useArrayBuffer?: boolean,\r\n    onError?: (request?: IWebRequest, exception?: any) => void,\r\n    injectedLoadFile?: (\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string | undefined) => void,\r\n        onProgress?: ((ev: ProgressEvent<EventTarget>) => void) | undefined,\r\n        offlineProvider?: IOfflineProvider | undefined,\r\n        useArrayBuffer?: boolean | undefined,\r\n        onError?: ((request?: WebRequest | undefined, exception?: LoadFileError | undefined) => void) | undefined\r\n    ) => IFileRequest\r\n): IFileRequest {\r\n    const loadFile = injectedLoadFile || EngineFunctionContext.loadFile;\r\n    if (loadFile) {\r\n        const request = loadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n        return request;\r\n    }\r\n    throw _WarnImport(\"FileTools\");\r\n}\r\n\r\n/**\r\n * Gets host document\r\n * @param renderingCanvas if provided, the canvas' owner document will be returned\r\n * @returns the host document object\r\n */\r\nexport function getHostDocument(renderingCanvas: Nullable<HTMLCanvasElement> = null): Nullable<Document> {\r\n    if (renderingCanvas && renderingCanvas.ownerDocument) {\r\n        return renderingCanvas.ownerDocument;\r\n    }\r\n\r\n    return IsDocumentAvailable() ? document : null;\r\n}\r\n\r\n/** @internal */\r\nexport function _getGlobalDefines(\r\n    defines?: { [key: string]: string },\r\n    isNDCHalfZRange?: boolean,\r\n    useReverseDepthBuffer?: boolean,\r\n    useExactSrgbConversions?: boolean\r\n): string | undefined {\r\n    if (defines) {\r\n        if (isNDCHalfZRange) {\r\n            defines[\"IS_NDC_HALF_ZRANGE\"] = \"\";\r\n        } else {\r\n            delete defines[\"IS_NDC_HALF_ZRANGE\"];\r\n        }\r\n        if (useReverseDepthBuffer) {\r\n            defines[\"USE_REVERSE_DEPTHBUFFER\"] = \"\";\r\n        } else {\r\n            delete defines[\"USE_REVERSE_DEPTHBUFFER\"];\r\n        }\r\n        if (useExactSrgbConversions) {\r\n            defines[\"USE_EXACT_SRGB_CONVERSIONS\"] = \"\";\r\n        } else {\r\n            delete defines[\"USE_EXACT_SRGB_CONVERSIONS\"];\r\n        }\r\n        return;\r\n    } else {\r\n        let s = \"\";\r\n        if (isNDCHalfZRange) {\r\n            s += \"#define IS_NDC_HALF_ZRANGE\";\r\n        }\r\n        if (useReverseDepthBuffer) {\r\n            if (s) {\r\n                s += \"\\n\";\r\n            }\r\n            s += \"#define USE_REVERSE_DEPTHBUFFER\";\r\n        }\r\n        if (useExactSrgbConversions) {\r\n            if (s) {\r\n                s += \"\\n\";\r\n            }\r\n            s += \"#define USE_EXACT_SRGB_CONVERSIONS\";\r\n        }\r\n        return s;\r\n    }\r\n}\r\n"]}