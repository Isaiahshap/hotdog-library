"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@react-three/fiber"),r=require("three"),t=require("three-stdlib"),n=require("@monogrid/gainmap-js"),s=require("../helpers/environment-assets.cjs.js"),i=require("../helpers/deprecated.cjs.js"),o=require("react");const a=e=>Array.isArray(e);exports.useEnvironment=function({files:p=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:l="",preset:c,encoding:d,extensions:u}={}){var g;let b=null,h=!1;if(c){if(!(c in s.presetsObj))throw new Error("Preset must be one of: "+Object.keys(s.presetsObj).join(", "));p=s.presetsObj[c],l="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/"}const j=a(p)&&6===p.length,f=a(p)&&3===p.length&&p.some((e=>e.endsWith("json"))),m=a(p)?p[0]:p;h=a(p);const E=j?"cube":f?"webp":m.startsWith("data:application/exr")?"exr":m.startsWith("data:application/hdr")?"hdr":m.startsWith("data:image/jpeg")?"jpg":null==(g=m.split(".").pop())||null==(g=g.split("?"))||null==(g=g.shift())?void 0:g.toLowerCase();if(b="cube"===E?r.CubeTextureLoader:"hdr"===E?t.RGBELoader:"exr"===E?t.EXRLoader:"jpg"===E||"jpeg"===E?n.HDRJPGLoader:"webp"===E?n.GainMapLoader:null,!b)throw new Error("useEnvironment: Unrecognized file extension: "+p);const w=e.useThree((e=>e.gl));o.useLayoutEffect((()=>{"webp"!==E&&"jpg"!==E&&"jpeg"!==E||w.domElement.addEventListener("webglcontextlost",(function(){e.useLoader.clear(b,h?[p]:p)}),{once:!0})}),[p,w.domElement]);const x=e.useLoader(b,h?[p]:p,(e=>{"webp"!==E&&"jpg"!==E&&"jpeg"!==E||e.setRenderer(w),null==e.setPath||e.setPath(l),u&&u(e)}));let L=h?x[0]:x;var v;return"jpg"!==E&&"jpeg"!==E&&"webp"!==E||(L=null==(v=L.renderTarget)?void 0:v.texture),L.mapping=j?r.CubeReflectionMapping:r.EquirectangularReflectionMapping,"colorSpace"in L?L.colorSpace=(null!=d?d:j)?"srgb":"srgb-linear":L.encoding=(null!=d?d:j)?i.sRGBEncoding:i.LinearEncoding,L};
